# 毒圈结构分析

**数据来源**：https://apexlegendsstatus.com/algs/ring-guessr

**结论**：推荐使用 API 获取坐标数据，而非图像处理方法提取毒圈信息。

## API 接口

### 接口地址

```
https://apexlegendsstatus.com/algs/ringguesser/api/getRandomRing?mode=ALGS&token=需要账户登录
```

### 返回数据示例

```json
{
  "success": true,
  "map": "mp_rr_district",
  "rings": [
    {"x": 9375, "y": 8529, "r": 5036},
    {"x": 11665, "y": 9680, "r": 2470},
    {"x": 12399, "y": 10287, "r": 1520}
  ]
}
```

## 坐标系统

### 地图坐标系

- **坐标系尺寸**：16384 × 16384（2^14）
- **地图图片尺寸**：4096 × 4096 像素
- **转换比例**：0.25（4096 / 16384）

### 坐标数据格式

API 返回的毒圈数据格式：
```json
{
  "x": 9449,    // 圆心 X 坐标（坐标系）
  "y": 8074,    // 圆心 Y 坐标（坐标系）
  "r": 4894     // 半径（坐标系）
}
```

### 坐标转换

坐标系 → 像素坐标：
```python
scale = 4096 / 16384  # 0.25
x_pixel = int(x_grid * scale)
y_pixel = int(y_grid * scale)
r_pixel = int(r_grid * scale)
```

**验证结果**：使用 16384 作为坐标系尺寸，绘制的毒圈与官方图片完美重合。

## 毒圈图片结构

### 图片尺寸

- 毒圈图片尺寸不固定（如 3820×1708、2234×1708 等）
- 包含 alpha 通道（RGBA 格式）
- 需要放大 4 倍后与地图叠加

### 叠加方式

1. 毒圈图片放大 4 倍
2. 居中对齐到地图
3. 使用 alpha 通道进行透明度混合

### Alpha 通道分布

**Alpha = 13**
- 第 1 级毒圈的填充区域
- 像素数量：约 21-22 万
- 特征：非常透明的白色填充

**Alpha > 247**
- 纯白色干扰像素（边框、虚线等）
- 数量较少（约 72-1458 个）
- 可使用 `utils/find_border.py` 移除

## 数据一致性

通过对比多张同地图毒圈文件，发现：

1. **Alpha 值分布高度一致**
   - Alpha = 13 始终是最多的像素
   - 边界像素范围稳定

2. **生成方式统一**
   - 所有毒圈图片使用相同的渲染方式
   - 可以用统一的方法处理

## 相关工具脚本

- `utils/find_border.py` - 移除毒圈图片中的干扰像素
- `utils/overlay_test.py` - 将毒圈图片叠加到地图上
- `utils/draw_rings.py` - 根据坐标数据在地图上绘制毒圈
