# 特征工程与坐标表示实验

本文档记录了针对毒圈预测任务的特征工程和坐标表示方式的消融实验结果。

## 实验设置

- **Baseline**: MLP (6→64→32→3)，参数量2,627
- **评估指标**: 场景2 Ring3圆心距离误差（像素）
- **Baseline误差**: 653.1 px

## 一、手工特征工程实验

使用baseline结构，在原始6维特征基础上添加手工特征。

### 实验结果

| 实验 | 添加特征 | 场景2误差 | 相对Baseline | 结论 |
|------|---------|-----------|-------------|------|
| exp1 | 无（baseline复现） | 661.6 px | -1.3% | ✓ 成功复现 |
| exp2 | 方向特征 (dx, dy) | 2792.9 px | -327.8% | ❌ 完全失败 |
| exp3 | 距离特征 | 797.7 px | -22.1% | ❌ 略差 |
| exp4 | 极坐标特征 (角度+归一化距离) | 2504.8 px | -283.5% | ❌ 失败 |
| exp5 | 地图位置特征 (Ring1相对地图中心) | 1239 px | -89.7% | ❌ 较差 |

### 特征说明

- **方向特征**: Ring2相对Ring1的偏移 (dx2=x2-x1, dy2=y2-y1)
- **距离特征**: Ring1到Ring2的欧氏距离
- **极坐标特征**: 
  - 角度: sin(θ), cos(θ)
  - 归一化距离: distance / (r1 - r2/2)
- **地图位置特征**: Ring1相对地图中心(0.5, 0.5)的位置

### 结论

**所有手工特征都使模型变差**。可能原因：
1. 模型容量太小（baseline结构），无法有效利用额外特征
2. 手工特征引入了噪声或不相关信息
3. 原始特征（6维坐标+半径）已包含足够信息

### 加深网络的尝试

对exp5（地图位置特征）使用更深网络：

| 网络结构 | 参数量 | 场景2误差 | 相对Baseline | 结论 |
|---------|--------|-----------|-------------|------|
| 6→64→32→3 | 2,627 | 1239 px | -89.7% | ❌ 失败 |
| 6→256→128→64→32→3 | 45,123 | 810.1 px | -24.0% | ❌ 仍然较差 |
| 6→512→256→128→64→32→3 | 178,243 | 846 px | -29.5% | ❌ 反而变差 |

**结论**: 即使加深网络，手工特征仍然无法提升性能。

## 二、坐标表示方式实验

探索不同的坐标表示方式对模型性能的影响。

### 2.1 完全绝对坐标（Baseline）

**表示方式**:
- Ring1: (x1, y1, r1) - 绝对坐标
- Ring2: (x2, y2, r2) - 绝对坐标
- Ring3: (x3, y3, r3) - 绝对坐标

**结果**:
- 场景2误差: 653.1 px

### 2.2 Ring1绝对 + Ring2/3相对Ring1

**表示方式**:
- Ring1: (x1, y1, r1) - 绝对坐标
- Ring2: (dx2, dy2, r2) - 相对Ring1，dx2=x2-x1, dy2=y2-y1
- Ring3: (dx3, dy3, r3) - 相对Ring1，dx3=x3-x1, dy3=y3-y1

**结果**:

| 网络结构 | 参数量 | 场景2误差 | 相对Baseline | 场景1误差 |
|---------|--------|-----------|-------------|-----------|
| 6→64→32→3 | 2,627 | 645.9 px | +1.1% ✓ | 2261.2 px (+6.5%) |
| 6→256→128→64→32→3 | 45,123 | 631.4 px | +3.3% ✓ | 2232.2 px (+7.7%) |
| 6→512→256→128→64→32→3 | 178,243 | **594.9 px** | **+8.9% ✓✓** | **2213.9 px (+8.5%)** |

### 2.3 完全相对坐标（Ring1也相对地图中心）

**表示方式**:
- Ring1: (dx1, dy1, r1) - 相对地图中心(0.5, 0.5)
- Ring2: (dx2, dy2, r2) - 相对Ring1
- Ring3: (dx3, dy3, r3) - 相对Ring1

**结果**:

| 网络结构 | 参数量 | 场景2误差 | 相对Baseline | 场景1误差 |
|---------|--------|-----------|-------------|-----------|
| 6→64→32→3 | 2,627 | 659.7 px | -1.0% ❌ | 2269.4 px (+6.2%) |
| 6→256→128→64→32→3 | 45,123 | 619.6 px | +5.1% ✓ | 2246.9 px (+7.1%) |
| 6→512→256→128→64→32→3 | 178,243 | **599.1 px** | **+8.3% ✓** | **2244.0 px (+7.3%)** |

### 2.4 Ring1绝对 + Ring2相对Ring1 + Ring3相对Ring2 🏆

**表示方式**:
- Ring1: (x1, y1, r1) - 绝对坐标
- Ring2: (dx2, dy2, r2) - 相对Ring1，dx2=x2-x1, dy2=y2-y1
- Ring3: (dx3, dy3, r3) - 相对Ring2，dx3=x3-x2, dy3=y3-y2

**结果**:

| 网络结构 | 参数量 | 场景2误差 | 相对Baseline | 场景1误差 |
|---------|--------|-----------|-------------|-----------|
| 6→64→32→3 | 2,627 | 636.2 px | +2.6% ✓ | 2294.5 px (+5.2%) |
| 6→256→128→64→32→3 | 45,123 | **571.8 px** | **+12.4% ✓✓✓** 🏆 | 2252.7 px (+6.9%) |
| 6→512→256→128→64→32→3 | 178,243 | **576.9 px** | **+11.7% ✓✓** | 2236.4 px (+7.6%) |

## 三、地图信息编码实验

探索如何将地图信息融入模型，支持多地图预测。

### 3.1 无地图信息（原始Baseline）

**表示方式**:
- 输入: 6维 (Ring1+Ring2坐标，相对坐标)
- 不包含任何地图信息
- 模型无法区分不同地图

**结果**:
- 场景2误差: 651.0 px
- 问题: 无法学习地图特定的规律

### 3.2 分地图训练（Per-Map Models）

**方案**:
- 每个地图训练独立模型
- District模型、Tropic模型分别训练

**结果（shallow: 6→64→32→3）**:
- 场景2误差: 629.3 px
- District: 656.3 px
- Tropic: 603.9 px

**结果（deep: 6→256→128→64→32→3）**:
- 场景2误差: 567.2 px
- District: 519.8 px
- Tropic: 611.6 px

**问题**:
- 两个地图表现不均衡（District过拟合）
- 每个模型数据量减半（~275条）
- 无法利用跨地图的共性规律
- 需要维护多个模型

### 3.3 One-Hot地图编码 🏆

**表示方式**:
- 输入: 8维 (6维坐标 + 2维One-Hot地图编码)
- District: [0, 1]
- Tropic: [1, 0]
- 单一模型处理所有地图

**结果（shallow: 8→64→32→3）**:
- 场景2误差: 621.3 px
- District: 621.1 px
- Tropic: 621.5 px
- 两个地图表现均衡

**结果（medium: 8→128→64→32→3）**:
- 场景2误差: 593.2 px
- District: 584.8 px
- Tropic: 601.0 px

**结果（deep: 8→256→128→64→32→3）**:
- 场景2误差: **508.0 px** 🏆
- District: 483.4 px
- Tropic: 531.0 px
- 相对无地图baseline提升22%
- 相对分地图deep提升10%

**结果（verydeep: 8→512→256→128→64→32→3）**:
- 场景2误差: 509.2 px
- 与deep性能相当，但参数量更大

### 3.4 One-Hot优于分地图的原因

1. **数据量优势**:
   - One-Hot: 550条训练数据
   - 分地图: 每个模型275条
   - 深度网络需要足够数据

2. **知识迁移**:
   - 毒圈收缩规律跨地图通用
   - One-Hot可以学习共性 + 地图差异
   - 分地图模型无法共享知识

3. **泛化能力**:
   - One-Hot模型两个地图表现均衡
   - 分地图模型容易在单个地图过拟合
   - 跨地图一致性起到隐式正则化作用

4. **可扩展性**:
   - 新地图只需扩展One-Hot维度并微调
   - 分地图需要从头训练新模型

## 四、最终结论

### 最佳方案

**相对坐标 + One-Hot地图编码 + 深度网络**

- **场景2误差**: 508.0 px 🏆
- **场景1 Ring2误差**: 1808.2 px
- **场景1 Ring3误差**: 2048.3 px
- **网络结构**: 8→256→128→64→32→3
- **参数量**: 45,123
- **输入特征**: 
  - Ring1: (x1, y1, r1) - 绝对坐标
  - Ring2: (dx2, dy2, r2) - 相对Ring1
  - 地图: One-Hot编码 (2维)

### 关键洞察

1. **手工特征无效**: 在简单MLP上添加手工特征反而降低性能，原始坐标特征已足够

2. **相对坐标优于绝对坐标**: 
   - 符合游戏机制（毒圈逐级收缩）
   - 学习相对规律而非绝对位置
   - 泛化能力更强

3. **Ring1保持绝对坐标的重要性**:
   - 提供地图全局信息
   - 包含边界效应信息
   - 作为稳定的参考锚点

4. **One-Hot编码是多地图任务的最佳方案**:
   - 优于分地图训练（数据效率、知识迁移）
   - 单一模型，易于维护
   - 两个地图表现均衡
   - 可扩展到更多地图

5. **网络深度的影响**:
   - 相对坐标方案需要更深的网络才能充分发挥优势
   - deep网络（45K参数）达到最佳性能
   - verydeep（178K参数）提升不明显，可能过拟合

6. **半径预测的局限**:
   - 所有模型的半径误差在20-45px范围
   - 未能趋近于0
   - 可能需要更复杂的特征或模型结构